{% load static %}
<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
        <link href="{% static 'index/css/index.css' %}" rel="stylesheet"/>
        <title>Movie Reviews Sentiment Analysis</title>
    </head>
    <body>
        <div class="container">
            <div class="col">
                <form class="form-login" action="" method="post">
                    {% csrf_token %}
                    <h1 class="text-center">Movie Reviews Sentiment Prediction.</h1>
                    <h5 class="text-center">Enter movie review below to judge it is Positive or Negative.</h5>
                    <div class="form-group">
                        <span style="font-size:18px;">
                            <select name="model" id="model">
                                <option value="pytorch" {% if model == 'pytorch' %}selected{% endif %}>Pytorch</option>
                                <option value="tensorflow" {% if model == 'tensorflow' %}selected{% endif %}>Tensorflow</option>
                            </select> 
                            <p></p>
                            You have typed 
                            <span id="counter">{{ text_length|default:0 }}</span> words.<br/>
                            <textarea class="form-control" rows="4" style="border: 1px; resize: none; width: 100%; background-color: #eee"
                                    id="postWeiboText" onkeydown='countChar("postWeiboText","counter");'
                                    onkeyup='countChar("postWeiboText","counter");' autocomplete="on"
                                    name="text">{{ text|default:"" }}</textarea>
                        </span>
                    </div>                   
                    <div id="feedback" style="background-color: rgba(255,255,255,0.4)">
                        <div id="sendButton">
                            <button type="submit" class="btn btn-primary float-right">
                                Submit
                            </button>
                        </div>
                        {% if output %}
                            {% if model == 'pytorch' %}
                                <p>The sentiment of your review is: 
                                    <b>
                                    {% if output > 0.5 %}
                                        POSITIVE
                                    {% else %}
                                        NEGATIVE
                                    {% endif %}
                                    </b>
                                </p>
                                <p>The score: {{ output }}</p>
                                {% if output > 0.5 %}
                                    <img class="text-center" src="{% static 'index/images/happy.png' %}" alt="" width="30%">
                                {% else %}
                                    <img class="text-center" src="{% static 'index/images/angry.png' %}" alt="" width="30%">
                                {% endif %}
                            {% else %}
                                <p>The sentiment of your review is: 
                                    <b>
                                    {% if pred == 2 %}
                                        POSITIVE
                                    {% elif pred == 1 %}
                                        NEUTRAL
                                    {% else %}
                                        NEGATIVE
                                    {% endif %}
                                    </b>
                                </p>
                                <p>Negative score: {{ output.0 }}</p>
                                <p>Neutral score: {{ output.1 }}</p>
                                <p>Positive score: {{ output.2 }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>

        <script>
            function countChar(textareaName,spanName) {
                var s = document.getElementById(textareaName).value;
                s = s.replace(/(^\s*)|(\s*$)/gi,"");
                s = s.replace(/[ ]{2,}/gi," "); 
                s = s.replace(/\n /,"\n");
                s = s.replace("\n"," ");
                var count = s.split(' ').filter(function(str){return str!="";}).length.toString();
                document.getElementById(spanName).innerHTML = count;
            }
        </script>

        <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
        <script src="https://cdn.bootcss.com/popper.js/1.15.0/umd/popper.js"></script>
        <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    </body>
</html>